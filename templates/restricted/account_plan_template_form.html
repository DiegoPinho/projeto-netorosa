{% extends "restricted/base.html" %}

{% block title %}PMOrganizer | {{ page_title }}{% endblock %}

{% block content %}
  <section class="section">
    <div class="section-title">
      <span class="eyebrow">Cadastro</span>
      <h2>{{ page_title }}</h2>
      <p>Preencha os campos para salvar o registro.</p>
    </div>

    <form method="post" class="form-card">
      {% csrf_token %}
      {% if form.non_field_errors %}
        <div class="form-errors">
          {% for error in form.non_field_errors %}
            <div class="form-error">{{ error }}</div>
          {% endfor %}
        </div>
      {% endif %}
      <div class="form-grid{% if form_columns == 2 %} is-two{% endif %}">
        {% for field in form %}
          {% if field.field.widget.input_type == "checkbox" %}
            <div class="form-field is-checkbox{% if field.name in full_width_fields %} span-full{% endif %}">
              <label class="checkbox" for="{{ field.id_for_label }}">
                {{ field }}
                <span>{{ field.label }}</span>
              </label>
              {% if field.help_text %}
                <small>{{ field.help_text }}</small>
              {% endif %}
              {% for error in field.errors %}
                <div class="form-error">{{ error }}</div>
              {% endfor %}
            </div>
          {% else %}
            <div class="form-field{% if field.name in full_width_fields %} span-full{% endif %}">
              <label for="{{ field.id_for_label }}">{{ field.label }}</label>
              {{ field }}
              {% if field.help_text %}
                <small>{{ field.help_text }}</small>
              {% endif %}
              {% for error in field.errors %}
                <div class="form-error">{{ error }}</div>
              {% endfor %}
            </div>
          {% endif %}
        {% endfor %}
      </div>
      <div class="form-footer">
        <button class="btn btn-primary" type="submit">{{ submit_label }}</button>
        <a class="btn btn-ghost" href="{{ cancel_url }}">Cancelar</a>
        <a class="btn btn-outline" href="{% url 'cadastros_web:account_plan_template_hierarchy' %}">Ver hierarquia</a>
      </div>
    </form>

    <div class="section-title" style="margin-top: 40px;">
      <span class="eyebrow">Itens</span>
      <h2>Contas do modelo</h2>
      <p>Cadastre codigos, niveis e agrupamentos DRE para este modelo.</p>
    </div>

    {% if template %}
      <div class="list-card">
        <div class="list-header">
          <h3>Contas cadastradas</h3>
          <span class="muted">{{ items|length }} contas</span>
        </div>
        <div class="data-table">
          <div class="data-row data-head" style="--cols: 13">
            <span>Codigo</span>
            <span>Descricao</span>
            <span>Nivel</span>
            <span>Conta pai</span>
            <span>Tipo</span>
            <span>Natureza</span>
            <span>Analitica</span>
            <span>Status</span>
            <span>Grupo DRE</span>
            <span>Linha DRE</span>
            <span>Ordem DRE</span>
            <span>Sinal DRE</span>
            <span>Acoes</span>
          </div>
          {% for item in items %}
            <div class="data-row" style="--cols: 13">
              <span>{{ item.code }}</span>
              <span>{{ item.description }}</span>
              <span>{{ item.level }}</span>
              <span>{{ item.parent.code|default:"-" }}</span>
              <span>{{ item.get_account_type_display }}</span>
              <span>{{ item.get_nature_display }}</span>
              <span>{{ item.is_analytic|yesno:"Sim,Nao" }}</span>
              <span>{{ item.get_status_display }}</span>
              <span>{{ item.dre_group }}</span>
              <span>{{ item.dre_subgroup|default:"-" }}</span>
              <span>{{ item.dre_order }}</span>
              <span>{{ item.get_dre_sign_display }}</span>
              <div class="row-actions row-actions-compact">
                <a class="btn btn-ghost btn-xs" href="{% url 'cadastros_web:account_plan_template_item_update' item.pk %}?next={{ item_next_url }}">Editar</a>
                <a class="btn btn-outline btn-xs" href="{% url 'cadastros_web:account_plan_template_item_delete' item.pk %}?next={{ item_next_url }}">Excluir</a>
              </div>
            </div>
          {% empty %}
            <div class="empty-state">Nenhuma conta cadastrada.</div>
          {% endfor %}
        </div>
      </div>

      {% if item_form %}
        <form method="post" action="{{ item_create_url }}" class="form-card" style="margin-top: 18px;">
          {% csrf_token %}
          {{ item_form.template }}
          <input type="hidden" name="next" value="{{ item_next_url }}">
          <div class="form-grid is-two">
            <div class="form-field">
              <label for="{{ item_form.code.id_for_label }}">{{ item_form.code.label }}</label>
              {{ item_form.code }}
              {% for error in item_form.code.errors %}
                <div class="form-error">{{ error }}</div>
              {% endfor %}
            </div>
            <div class="form-field">
              <label for="{{ item_form.level.id_for_label }}">{{ item_form.level.label }}</label>
              {{ item_form.level }}
              {% for error in item_form.level.errors %}
                <div class="form-error">{{ error }}</div>
              {% endfor %}
            </div>
            <div class="form-field">
              <label for="{{ item_form.parent.id_for_label }}">{{ item_form.parent.label }}</label>
              {{ item_form.parent }}
              {% for error in item_form.parent.errors %}
                <div class="form-error">{{ error }}</div>
              {% endfor %}
            </div>
            <div class="form-field">
              <label for="{{ item_form.account_type.id_for_label }}">{{ item_form.account_type.label }}</label>
              {{ item_form.account_type }}
              {% for error in item_form.account_type.errors %}
                <div class="form-error">{{ error }}</div>
              {% endfor %}
            </div>
            <div class="form-field">
              <label for="{{ item_form.nature.id_for_label }}">{{ item_form.nature.label }}</label>
              {{ item_form.nature }}
              {% for error in item_form.nature.errors %}
                <div class="form-error">{{ error }}</div>
              {% endfor %}
            </div>
            <div class="form-field">
              <label for="{{ item_form.status.id_for_label }}">{{ item_form.status.label }}</label>
              {{ item_form.status }}
              {% for error in item_form.status.errors %}
                <div class="form-error">{{ error }}</div>
              {% endfor %}
            </div>
            <div class="form-field">
              <label for="{{ item_form.is_analytic.id_for_label }}">{{ item_form.is_analytic.label }}</label>
              {{ item_form.is_analytic }}
              {% for error in item_form.is_analytic.errors %}
                <div class="form-error">{{ error }}</div>
              {% endfor %}
            </div>
            <div class="form-field span-full">
              <label for="{{ item_form.description.id_for_label }}">{{ item_form.description.label }}</label>
              {{ item_form.description }}
              {% for error in item_form.description.errors %}
                <div class="form-error">{{ error }}</div>
              {% endfor %}
            </div>
            <div class="form-field span-full">
              <label for="{{ item_form.dre_group.id_for_label }}">{{ item_form.dre_group.label }}</label>
              {{ item_form.dre_group }}
              {% for error in item_form.dre_group.errors %}
                <div class="form-error">{{ error }}</div>
              {% endfor %}
            </div>
            <div class="form-field span-full">
              <label for="{{ item_form.dre_subgroup.id_for_label }}">{{ item_form.dre_subgroup.label }}</label>
              {{ item_form.dre_subgroup }}
              {% for error in item_form.dre_subgroup.errors %}
                <div class="form-error">{{ error }}</div>
              {% endfor %}
            </div>
            <div class="form-field">
              <label for="{{ item_form.dre_order.id_for_label }}">{{ item_form.dre_order.label }}</label>
              {{ item_form.dre_order }}
              {% for error in item_form.dre_order.errors %}
                <div class="form-error">{{ error }}</div>
              {% endfor %}
            </div>
            <div class="form-field">
              <label for="{{ item_form.dre_sign.id_for_label }}">{{ item_form.dre_sign.label }}</label>
              {{ item_form.dre_sign }}
              {% for error in item_form.dre_sign.errors %}
                <div class="form-error">{{ error }}</div>
              {% endfor %}
            </div>
          </div>
          <div class="form-footer">
            <button class="btn btn-primary" type="submit">Adicionar conta</button>
          </div>
        </form>
      {% endif %}
    {% else %}
      <div class="list-card">
        <div class="empty-state">Salve o modelo para adicionar contas.</div>
      </div>
    {% endif %}
  </section>
{% endblock %}
